version: '3.1'

services:
    phpserver:
        image: phpserver
        container_name: phpserver
        build:
            context: ./php
        restart: always
        depends_on:
            - mercure
        volumes:
            - ../:/srv/app
    mercure:
        image: dunglas/mercure
        environment:
            - JWT_KEY=aVerySecretKey
            - ALLOW_ANONYMOUS=1
            - CORS_ALLOWED_ORIGINS=*
            - PUBLISH_ALLOWED_ORIGINS=http://localhost
            - DEMO=1
        ports:
            - 3000:80
        labels:
            - traefik.frontend.rule=Host:localhost
